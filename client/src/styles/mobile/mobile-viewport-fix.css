/* ==========================================
   MOBILE VIEWPORT FIX - НАДІЙНЕ РІШЕННЯ
   Виправляє проблеми з адресною строкою браузера
   Використовує dvh (dynamic viewport height) для ідеального розміру
   ========================================== */

/* CSS змінні для viewport */
:root {
  --vh: 1vh;
  --dvh: 1dvh; /* Dynamic Viewport Height - враховує адресний рядок */
  --bottom-nav-height: 56px;
  --safe-area-bottom: env(safe-area-inset-bottom, 0px);
  --app-bottom-offset: calc(var(--bottom-nav-height) + var(--safe-area-bottom));
  --messenger-height: 100dvh; /* Динамічна висота */
}

@media (max-width: 1023px) {

  /* ==========================================
     БАЗОВА СТРУКТУРА З ДИНАМІЧНОЮ ВИСОТОЮ
     ========================================== */

  /* Використовуємо динамічну висоту (dvh) замість 100vh */
  html, body {
    height: 100dvh !important; /* Dynamic Viewport Height враховує браузерний UI */
    min-height: 100dvh !important;
    max-height: 100dvh !important;
    overflow-x: hidden;
    overflow-y: hidden !important;
    position: fixed !important;
    width: 100%;
    top: 0;
    left: 0;
    right: 0;
  }

  /* Messenger залишається фулскрін, інші сторінки можуть скролитись */
  body.messenger-page {
    overflow: hidden;
    position: fixed;
    inset: 0;
    width: 100%;
  }

  /* Root контейнер */
  #root {
    height: 100dvh !important;
    min-height: 100dvh !important;
    max-height: 100dvh !important;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
  }

  /* Головний app контейнер БЕЗ padding-bottom */
  #mobile-app-root {
    height: 100dvh !important;
    min-height: 100dvh !important;
    max-height: 100dvh !important;
    display: flex;
    flex-direction: column;
    padding-bottom: 0 !important; /* Видаляємо pb-16 */
    overflow: hidden;
    position: relative;
  }

  /* Main content - займає весь простір */
  main.mobile-scroll-container {
    flex: 1;
    min-height: 0;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    padding-bottom: calc(var(--app-bottom-offset) + 12px) !important;
    position: relative;
  }

  /* ==========================================
     BOTTOM NAVIGATION - ФІКСОВАНА ВНИЗУ
     ========================================== */

  .bottom-nav-mobile {
    position: fixed !important;
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    height: calc(var(--bottom-nav-height) + env(safe-area-inset-bottom, 0)) !important;
    padding-bottom: env(safe-area-inset-bottom, 0) !important;
    z-index: 9998 !important; /* НИЖЧЕ MESSENGER INPUT (9999) */
    background: rgba(15, 23, 42, 0.98) !important;
    backdrop-filter: blur(24px) saturate(180%) !important;
    -webkit-backdrop-filter: blur(24px) saturate(180%) !important;
    border-top: 1px solid rgba(148, 163, 184, 0.15) !important;
    box-shadow: 0 -4px 16px rgba(0, 0, 0, 0.25) !important;
  }

  /* ==========================================
     MESSENGER PAGE СПЕЦИФІЧНІ СТИЛІ
     ========================================== */

  /* Messenger page контейнер - використовує повну висоту */
  body.messenger-page .messenger-page-container {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    height: 100dvh !important; /* Dynamic Viewport Height */
    overflow: hidden !important;
    z-index: auto !important; /* НЕ створюємо stacking context */
  }

  /* Messenger mobile container - займає весь простір */
  .messenger-mobile-container {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    height: 100dvh !important;
    max-height: 100dvh !important;
    overflow: hidden !important;
    display: flex !important;
    flex-direction: column !important;
  }

  /* Messenger list view - правильна висота */
  body.messenger-page .messenger-mobile-list-view {
    height: 100% !important;
    display: flex !important;
    flex-direction: column !important;
    overflow: hidden !important;
  }

  /* Contact list - займає доступний простір */
  body.messenger-page .contact-list {
    flex: 1 !important;
    min-height: 0 !important;
    overflow: hidden !important;
    display: flex !important;
    flex-direction: column !important;
  }

  /* Contact list grid - скролиться */
  body.messenger-page .contact-list__grid {
    flex: 1 !important;
    min-height: 0 !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    padding-bottom: 20px !important;
  }

  /* Messenger layout overrides removed in favor of native skin */

  /* ==========================================
     ІНШІ СТОРІНКИ - З BOTTOM NAV PADDING
     ========================================== */

  /* Всі сторінки крім messenger мають padding для bottom nav */
  body:not(.messenger-page) main {
    padding-bottom: var(--app-bottom-offset) !important;
  }

  /* Dashboard, Kanban та інші - правильний скролл */
  body:not(.messenger-page) .overflow-y-auto {
    max-height: calc(100dvh - var(--bottom-nav-height) - 64px) !important; /* -header */
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
  }

  /* ==========================================
     iOS SAFARI SPECIFIC
     ========================================== */

  @supports (-webkit-touch-callout: none) {
    /* iOS Safari має свої особливості з viewport */
    html, body {
      height: -webkit-fill-available !important;
      min-height: -webkit-fill-available !important;
    }

    #root, #mobile-app-root {
      height: -webkit-fill-available !important;
      min-height: -webkit-fill-available !important;
    }

    body.messenger-page .messenger-page-container {
      height: -webkit-fill-available !important;
    }

    .messenger-mobile-container {
      max-height: -webkit-fill-available !important;
    }
  }

  /* ==========================================
     LANDSCAPE MODE
     ========================================== */

  @media (orientation: landscape) and (max-height: 500px) {
    /* В landscape режимі bottom nav може бути меншим */
    :root {
      --bottom-nav-height: 48px;
    }

    .bottom-nav-mobile {
      height: 48px !important;
    }

    .bottom-nav-item span {
      display: none !important; /* Ховаємо текст в landscape */
    }
  }

  /* ==========================================
     DEBUG HELPERS (видалити в продакшн)
     ========================================== */

  /* Показує поточну висоту viewport для debug */
  body::after {
    content: 'VH: ' var(--vh) ' | Bottom: ' var(--app-bottom-offset);
    position: fixed;
    bottom: 100px;
    right: 10px;
    background: rgba(0, 0, 0, 0.8);
    color: lime;
    padding: 5px;
    font-size: 10px;
    z-index: 99999;
    display: none; /* Увімкнути для debug */
  }
}

/* ==========================================
   КРИТИЧНІ ВИПРАВЛЕННЯ
   ========================================== */

@media (max-width: 1023px) {
  /* Видаляємо всі pb-16 класи */
  .pb-16 {
    padding-bottom: 0 !important;
  }

  /* Messenger має власну логіку bottom offset */
  .messenger-page-container,
  .messenger-mobile-container {
    padding-bottom: 0 !important;
    margin-bottom: 0 !important;
  }

  /* Переконуємось що fixed контейнер Messages.js правильний */
  .fixed.inset-x-0.bottom-0 {
    bottom: 0 !important;
    padding-bottom: 0 !important;
  }
}
